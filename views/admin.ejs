<!DOCTYPE html>
<html ng-app="app">
  <head>
    <title><%= title %></title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel='stylesheet' href='/css/bootstrap.css' />
    <link rel='stylesheet' href='/css/style.css' />

  </head>
  <body>
    <h1><%= title %></h1>

    <ng-view></ng-view>

    <!-- Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-route.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-resource.min.js"></script>

    <!-- Templates -->
    <script type="text/ng-template" id="/games.html">

      <div class="form-group container">
        <label for="search" class="input_label">Search</label>
        <input type="text" ng-model="search.name" id="search" class="form-control">
      </div>

      <ul class="container list-unstyled">
        <li ng-repeat="game in games | filter: search">

          <blockquote>

            <a ng-show="!editing[$index]" href="#/{{game._id}}" class="lead">{{game.name}}</a>
            <button ng-show="!editing[$index]" ng-click="edit($index)" class="btn btn-info btn-xs">edit</button>

            <input ng-show="editing[$index]" type="text" ng-model="game.name">
            <button ng-show="editing[$index]" ng-click="update($index)" class="btn btn-primary btn-xs">Update</button>
            <button ng-show="editing[$index]" ng-click="cancel($index)" class="btn btn-warning btn-xs">Cancel</button>
            <button ng-show="!editing[$index]" ng-click="remove($index)" class="btn btn-danger btn-xs">remove</button>

        </blockquote>

        </li>
      </ul>

      <div class="container form">

        <p class="lead">New game</p>

        <div class="form-group">
          <label for="gameName" class="input_label">Game name</label>
          <input type="text" ng-model="gameName" id="gameName" class="form-control">
        </div>

        <div class="form-group">
          <label for="teamA" class="input_label">Team A</label>
          <input type="text" ng-model="teamA" id="teamA" class="form-control">
        </div>

        <div class="form-group">
          <label for="teamB" class="input_label">Team B</label>
          <input type="text" ng-model="teamB" id="teamB" class="form-control">
        </div>

        <button ng-click="save()" class="btn btn-primary btn-xs">Create</button>

      </div>
    </script>

    <script type="text/ng-template" id="/gameDetails.html">

      <div class="container form">

        <h2 class="">{{game.name}}</h2>

        <div class="teamInfo">

          <p class="lead">{{game.teamA}}</p>

          <div class="form-group">

            <label for="gameName" class="input_label">Goals</label>

            <button ng-click="scoreAmin()" class="btn btn-danger btn-xs inline">-</button>
            <p class="inline">{{game.scoreA}}</p>
            <button ng-click="scoreAplus()" class="btn btn-success btn-xs inline">+</button>

          </div>

          <div class="form-group">

            <label class="input_label">Shots</label>

            <button ng-click="shotsAmin()" class="btn btn-danger btn-xs inline">-</button>
            <p class="inline">{{game.shotsA}}</p>
            <button ng-click="shotsAplus()" class="btn btn-success btn-xs inline">+</button>

          </div>

          <div class="form-group">

            <label class="input_label">Fauls</label>

            <button ng-click="faulsAmin()" class="btn btn-danger btn-xs inline">-</button>
            <p class="inline">{{game.faulsA}}</p>
            <button ng-click="faulsAplus()" class="btn btn-success btn-xs inline">+</button>

          </div>

        </div>

        <div class="teamInfo">

          <p class="lead">{{game.teamB}}</p>

          <div class="form-group">

            <label for="gameName" class="input_label">Goals</label>

            <button ng-click="scoreBmin()" class="btn btn-danger btn-xs inline">-</button>
            <p class="inline">{{game.scoreB}}</p>
            <button ng-click="scoreBplus()" class="btn btn-success btn-xs inline">+</button>

          </div>

          <div class="form-group">

            <label class="input_label">Shots</label>

            <button ng-click="shotsBmin()" class="btn btn-danger btn-xs inline">-</button>
            <p class="inline">{{game.shotsB}}</p>
            <button ng-click="shotsBplus()" class="btn btn-success btn-xs inline">+</button>

          </div>

          <div class="form-group">

            <label class="input_label">Fauls</label>

            <button ng-click="faulsBmin()" class="btn btn-danger btn-xs inline">-</button>
            <p class="inline">{{game.faulsB}}</p>
            <button ng-click="faulsBplus()" class="btn btn-success btn-xs inline">+</button>

          </div>

        </div>

        <div class="clearFix"></div>

        <div class="form-group">

          <label class="input_label">Comments</label>

          <ul class="container list-unstyled">

            <li ng-repeat=" comment in game.comments">

              <blockquote>

                <p>{{comment.value}}</p>

              </blockquote>

            </li>

          </ul>

          <input type="text" ng-model="commentValue">
          <button ng-click="sendComment()" class="btn btn-primary btn-xs">Send</button>

        </div>






      </div>

    </script>

    <script>
      angular.module('app', ['ngRoute', 'ngResource'])

        //---------------
        // Services
        //---------------

        .factory('Games', ['$resource', function($resource){
          return $resource('/games/:id', null, {
            'update': { method:'PUT' }
          });
        }])

        //---------------
        // Controllers
        //---------------

        .controller('GameController', ['$scope', 'Games', function ($scope, Games) {
          $scope.editing = [];
          $scope.games = Games.query();

          $scope.save = function(){
            if(!$scope.gameName || $scope.gameName.length < 1) return;
            var game = new Games({
                                    name: $scope.gameName,
                                    teamA: $scope.teamA,
                                    teamB: $scope.teamB,
                                    scoreA: 0,
                                    scoreB: 0,
                                    shotsA: 0,
                                    shotsB: 0,
                                    faulsA: 0,
                                    faulsB: 0
                                  });

            game.$save(function(){
              $scope.games.push(game);
              $scope.gameName = ''; // clear textbox
            });
          }

          $scope.update = function(index){
            var game = $scope.games[index];
            Games.update({id: game._id}, game);
            $scope.editing[index] = false;
          }

          $scope.edit = function(index){
            $scope.editing[index] = angular.copy($scope.games[index]);
          }

          $scope.cancel = function(index){
            $scope.games[index] = angular.copy($scope.editing[index]);
            $scope.editing[index] = false;
          }

          $scope.remove = function(index){
            var games = $scope.games[index];
            Games.remove({id: game._id}, function(){
              $scope.games.splice(index, 1);
            });
          }
        }])

        .controller('GameDetailCtrl', ['$scope', '$routeParams', 'Games', '$location', function ($scope, $routeParams, Games, $location) {
          $scope.game = Games.get({id: $routeParams.id });


          // SCORE
          $scope.scoreAplus = function(){
            $scope.game.scoreA ++;
            $scope.update();
          }

          $scope.scoreAmin = function(){
            $scope.game.scoreA --;
            $scope.update();
          }

          $scope.scoreBplus = function(){
            $scope.game.scoreB ++;
            $scope.update();
          }

          $scope.scoreBmin = function(){
            $scope.game.scoreB --;
            $scope.update();
          }


          // SHOTS
          $scope.shotsAplus = function(){
            $scope.game.shotsA ++;
            $scope.update();
          }

          $scope.shotsAmin = function(){
            $scope.game.shotsA --;
            $scope.update();
          }

          $scope.shotsBplus = function(){
            $scope.game.shotsB ++;
            $scope.update();
          }

          $scope.shotsBmin = function(){
            $scope.game.shotsB --;
            $scope.update();
          }

          // FAULS
          $scope.faulsAplus = function(){
            $scope.game.faulsA ++;
            $scope.update();
          }

          $scope.faulsAmin = function(){
            $scope.game.faulsA --;
            $scope.update();
          }

          $scope.faulsBplus = function(){
            $scope.game.faulsB ++;
            $scope.update();
          }

          $scope.faulsBmin = function(){
            $scope.game.faulsB --;
            $scope.update();
          }

          // COMMENTS
          $scope.sendComment = function(){
            var i = {};
            i.value =  $scope.commentValue;
            $scope.game.comments.push(i);
            $scope.update();
            $scope.commentValue = '';
          }


          $scope.update = function(){
            var game = $scope.game;
            Games.update({id: $routeParams.id }, game);
          }

          $scope.remove = function(){
            Games.remove({id: $scope.game._id}, function(){
              $location.url('/');
            });
          }
        }])

        //---------------
        // Routes
        //---------------

        .config(['$routeProvider', function ($routeProvider) {
          $routeProvider
            .when('/', {
              templateUrl: '/games.html',
              controller: 'GameController'
            })

            .when('/:id', {
              templateUrl: '/gameDetails.html',
              controller: 'GameDetailCtrl'
           });
        }]);
    </script>
  </body>
</html>
